<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>TMap Example</title>
    <script src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=P4s73F9IVz7sHlNhyg3RC9PwWamafSQb1Zy0g4cy"></script>
    <style>
      html,
      body,
      #map_div {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map_div"></div>
    <script>
      let currentLocationPoint;
      let startPoint;
      let stopoverPoints = [];
      let endPoint;
      let map;
      function initTmap(latitude, longitude) {
        map = new Tmapv2.Map("map_div", {
          center: new Tmapv2.LatLng(latitude, longitude),
          width: "100%",
          height: "100%",
          zoom: 19,
        });

        currentLocationPoint = new Tmapv2.Marker({
          position: new Tmapv2.LatLng(latitude, longitude),
          icon: "/assets/userPing.png",
          iconSize: new Tmapv2.Size(100, 100),
          map: map,
        });

        // 터치 이벤트 리스너 추가
        map.addListener("touchend", function (evt) {
          const lat = evt.latLng.lat();
          const lng = evt.latLng.lng();
          const coordinates = { lat, lng };
          window.ReactNativeWebView.postMessage(JSON.stringify(coordinates));
        });
      }

      function addMarker(lat, lng, routeStage) {
        if (routeStage === "setStartingPoint") {
          if (startPoint) startPoint.setMap(null);
          startPoint = new Tmapv2.Marker({
            position: new Tmapv2.LatLng(lat, lng),
            iconSize: new Tmapv2.Size(100, 300),
            map: map,
          });
        } else if (routeStage === "setStopoverPoint") {
          const stopoverPoint = new Tmapv2.Marker({
            position: new Tmapv2.LatLng(lat, lng),
            iconSize: new Tmapv2.Size(300, 300),
            map: map,
          });
          stopoverPoints.push(stopoverPoint);
        } else if (routeStage === "setDestinationPoint") {
          if (endPoint) endPoint.setMap(null);
          endPoint = new Tmapv2.Marker({
            position: new Tmapv2.LatLng(lat, lng),
            iconSize: new Tmapv2.Size(300, 300),
            map: map,
          });
        }
      }
    </script>
  </body>
</html>
